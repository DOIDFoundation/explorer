import{S as O,p as l}from"./vendor-a218ddb8.js";/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var p=function(n,e){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,s){t.__proto__=s}||function(t,s){for(var i in s)s.hasOwnProperty(i)&&(t[i]=s[i])},p(n,e)};function m(n,e){p(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function T(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var s=t.call(n),i,r=[],o;try{for(;(e===void 0||e-- >0)&&!(i=s.next()).done;)r.push(i.value)}catch(u){o={error:u}}finally{try{i&&!i.done&&(t=s.return)&&t.call(s)}finally{if(o)throw o.error}}return r}function C(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(T(arguments[e]));return n}var b=function(){function n(e,t){this.target=t,this.type=e}return n}(),L=function(n){m(e,n);function e(t,s){var i=n.call(this,"error",s)||this;return i.message=t.message,i.error=t,i}return e}(b),S=function(n){m(e,n);function e(t,s,i){t===void 0&&(t=1e3),s===void 0&&(s="");var r=n.call(this,"close",i)||this;return r.wasClean=!0,r.code=t,r.reason=s,r}return e}(b),k=function(){if(typeof WebSocket<"u")return WebSocket},D=function(n){return typeof n<"u"&&!!n&&n.CLOSING===2},a={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},N=function(){function n(e,t,s){var i=this;s===void 0&&(s={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=void 0,this.onerror=void 0,this.onmessage=void 0,this.onopen=void 0,this._handleOpen=function(r){i._debug("open event");var o=i._options.minUptime,u=o===void 0?a.minUptime:o;clearTimeout(i._connectTimeout),i._uptimeTimeout=setTimeout(function(){return i._acceptOpen()},u),i._ws.binaryType=i._binaryType,i._messageQueue.forEach(function(c){return i._ws.send(c)}),i._messageQueue=[],i.onopen&&i.onopen(r),i._listeners.open.forEach(function(c){return i._callEventListener(r,c)})},this._handleMessage=function(r){i._debug("message event"),i.onmessage&&i.onmessage(r),i._listeners.message.forEach(function(o){return i._callEventListener(r,o)})},this._handleError=function(r){i._debug("error event",r.message),i._disconnect(void 0,r.message==="TIMEOUT"?"timeout":void 0),i.onerror&&i.onerror(r),i._debug("exec error listeners"),i._listeners.error.forEach(function(o){return i._callEventListener(r,o)}),i._connect()},this._handleClose=function(r){i._debug("close event"),i._clearTimeouts(),i._shouldReconnect&&i._connect(),i.onclose&&i.onclose(r),i._listeners.close.forEach(function(o){return i._callEventListener(r,o)})},this._url=e,this._protocols=t,this._options=s,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(n,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(n,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(n,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(n,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"CONNECTING",{get:function(){return n.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"OPEN",{get:function(){return n.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"CLOSING",{get:function(){return n.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"CLOSED",{get:function(){return n.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bufferedAmount",{get:function(){var e=this._messageQueue.reduce(function(t,s){return typeof s=="string"?t+=s.length:s instanceof Blob?t+=s.size:t+=s.byteLength,t},0);return e+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?n.CLOSED:n.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),n.prototype.close=function(e,t){if(e===void 0&&(e=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(e,t)},n.prototype.reconnect=function(e,t){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(e,t),this._connect())},n.prototype.send=function(e){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",e),this._ws.send(e);else{var t=this._options.maxEnqueuedMessages,s=t===void 0?a.maxEnqueuedMessages:t;this._messageQueue.length<s&&(this._debug("enqueue",e),this._messageQueue.push(e))}},n.prototype.addEventListener=function(e,t){this._listeners[e]&&this._listeners[e].push(t)},n.prototype.removeEventListener=function(e,t){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(function(s){return s!==t}))},n.prototype._debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._options.debug&&console.log.apply(console,C(["RWS>"],e))},n.prototype._getNextDelay=function(){var e=this._options,t=e.reconnectionDelayGrowFactor,s=t===void 0?a.reconnectionDelayGrowFactor:t,i=e.minReconnectionDelay,r=i===void 0?a.minReconnectionDelay:i,o=e.maxReconnectionDelay,u=o===void 0?a.maxReconnectionDelay:o,c=0;return this._retryCount>0&&(c=r*Math.pow(s,this._retryCount-1),c>u&&(c=u)),this._debug("next delay",c),c},n.prototype._wait=function(){var e=this;return new Promise(function(t){setTimeout(t,e._getNextDelay())})},n.prototype._getNextUrl=function(e){if(typeof e=="string")return Promise.resolve(e);if(typeof e=="function"){var t=e();if(typeof t=="string")return Promise.resolve(t);if(t.then)return t}throw Error("Invalid URL")},n.prototype._connect=function(){var e=this;if(!(this._connectLock||!this._shouldReconnect)){this._connectLock=!0;var t=this._options,s=t.maxRetries,i=s===void 0?a.maxRetries:s,r=t.connectionTimeout,o=r===void 0?a.connectionTimeout:r,u=t.WebSocket,c=u===void 0?k():u;if(this._retryCount>=i){this._debug("max retries reached",this._retryCount,">=",i);return}if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!D(c))throw Error("No valid WebSocket class provided");this._wait().then(function(){return e._getNextUrl(e._url)}).then(function(d){e._closeCalled||(e._debug("connect",{url:d,protocols:e._protocols}),e._ws=e._protocols?new c(d,e._protocols):new c(d),e._ws.binaryType=e._binaryType,e._connectLock=!1,e._addListeners(),e._connectTimeout=setTimeout(function(){return e._handleTimeout()},o))})}},n.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new L(Error("TIMEOUT"),this))},n.prototype._disconnect=function(e,t){if(e===void 0&&(e=1e3),this._clearTimeouts(),!!this._ws){this._removeListeners();try{this._ws.close(e,t),this._handleClose(new S(e,t,this))}catch{}}},n.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},n.prototype._callEventListener=function(e,t){"handleEvent"in t?t.handleEvent(e):t(e)},n.prototype._removeListeners=function(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},n.prototype._addListeners=function(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},n.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},n}();const x=typeof process<"u"?"arraybuffer":"blob",y={},g=n=>{let e=n.data;return e?(n.data instanceof ArrayBuffer&&(e=new TextDecoder().decode(e)),JSON.parse(e)):n};class P{constructor({uri:e,binaryType:t,ping:s,options:i}){this.uri=e,t||(t=x),typeof TextEncoder>"u"&&(t="blob"),this.binaryType=t,this.id=10,this.sendQueue=[],this.callbacks=new Map,this.keeper=null,this.pingFrame=s||"ðŸ’§",this.keeping=()=>{clearTimeout(this.keeper),this.keeper=setTimeout(()=>{this.send(this.pingFrame),this.keeping()},5500)};let r=y[e];if(r)return this.ws=r;this.ws=r=y[e]=new N(e,[],i),this.ws.addEventListener("open",()=>{for(this.ws.binaryType=this.binaryType;this.sendQueue.length;)this.send(this.sendQueue.shift());this.keeping()}),this.ws.addEventListener("message",o=>{const u=g(o),c=this.callbacks.get(u.id);c&&(c(u.result||u),this.callbacks.delete(u.id))})}send(e,t){let s=e;typeof s=="object"&&(s=Object.assign({},s,{id:this.id++}),t&&this.callbacks.set(s.id,t),s=JSON.stringify(s)),this.ws.readyState===1?this.ws.send(this.binaryType==="arraybuffer"?new TextEncoder().encode(s).buffer:s):s!==this.pingFrame&&this.sendQueue.push(s)}on(e,t){const s=i=>t(g(i));return this.ws.addEventListener(e,s),s}off(e,t){this.ws.removeEventListener(e,t)}}const j={testnet:{chainId:"testnet",title:"DOID Testnet",name:"DOIDTestnet",provider:"http://54.221.168.235:8556",providerWs:"ws://54.221.168.235:8557",scan:"http://explorer.testnet.doid.tech",icon:""}},I="testnet",v=j[I];var R=Object.defineProperty,B=Object.getOwnPropertyDescriptor,f=(n,e,t,s)=>{for(var i=s>1?void 0:s?B(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&R(e,t,i),i};const w=new P({uri:v.providerWs,ping:'{"jsonrpc":"2.0","method":"node_status"}'}),_=async(n,e)=>w.send({jsonrpc:"2.0",...n},e),E=`blocks.${v.chainId}`,M=JSON.parse(sessionStorage.getItem(E)??"[]").map(n=>(delete n.incoming,n));class h extends O{constructor(){super(),this.delay=3e3,this.updateBlocks=async()=>{const e=new Date().getTime();this.blocks=this.blocks.map(t=>{const{incoming:s=!1,timestamp:i=0}=t;return s&&i&&e-+i*1e3>this.delay&&delete t.incoming,t}),sessionStorage.setItem(E,JSON.stringify(this.blocks))},this.addBlock=(e,t=!1)=>{!e||this.blocks.some(s=>s.height===e.height)||(e.incoming=!0,setTimeout(()=>e.incoming=!1,this.delay),this.blocks.unshift(e),this.blocks.sort((s,i)=>i.height-s.height),this.blocks.length=Math.min(this.limit,this.blocks.length),t&&this.updateBlocks())},this.getBlocks=async()=>{this.pending=!0,_({method:"doid_currentBlock",params:[]},({header:e}={})=>{this.addBlock(e);for(let t=e.height-1;t>e.height-this.limit;t--)_({method:"doid_getBlockByHeight",params:[t]},s=>{this.addBlock(s==null?void 0:s.header),this.ts++})}),this.updateBlocks(),this.pending=!1},this.getBlocks(),_({method:"doid_subscribe",params:["newHeads"]}),this.ws.on("message",({method:e,params:t}={})=>{if(!t)return;const{header:s}=t==null?void 0:t.result;switch(e){case"doid_subscription":s&&this.addBlock(s,!0);return}}),this.ws.on("open",this.getBlocks)}get isEmpty(){return this.ts&&!this.blocks.length}get loading(){return!this.ts}get isConnected(){const{ws:{readyState:e,OPEN:t}}=this.ws;return e===t}}f([l({value:w})],h.prototype,"ws",2);f([l({value:!1})],h.prototype,"pending",2);f([l({value:0})],h.prototype,"ts",2);f([l({value:20})],h.prototype,"limit",2);f([l({value:M})],h.prototype,"blocks",2);const G=new h;export{G as u,_ as w};
