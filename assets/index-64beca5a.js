import{S,p as f}from"./vendor-efda1ba5.js";/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var y=function(n,e){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},y(n,e)};function w(n,e){y(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function k(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(c){s={error:c}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(s)throw s.error}}return o}function L(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(k(arguments[e]));return n}var E=function(){function n(e,t){this.target=t,this.type=e}return n}(),D=function(n){w(e,n);function e(t,r){var i=n.call(this,"error",r)||this;return i.message=t.message,i.error=t,i}return e}(E),N=function(n){w(e,n);function e(t,r,i){t===void 0&&(t=1e3),r===void 0&&(r="");var o=n.call(this,"close",i)||this;return o.wasClean=!0,o.code=t,o.reason=r,o}return e}(E),x=function(){if(typeof WebSocket<"u")return WebSocket},P=function(n){return typeof n<"u"&&!!n&&n.CLOSING===2},l={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},I=function(){function n(e,t,r){var i=this;r===void 0&&(r={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=void 0,this.onerror=void 0,this.onmessage=void 0,this.onopen=void 0,this._handleOpen=function(o){i._debug("open event");var s=i._options.minUptime,c=s===void 0?l.minUptime:s;clearTimeout(i._connectTimeout),i._uptimeTimeout=setTimeout(function(){return i._acceptOpen()},c),i._ws.binaryType=i._binaryType,i._messageQueue.forEach(function(u){return i._ws.send(u)}),i._messageQueue=[],i.onopen&&i.onopen(o),i._listeners.open.forEach(function(u){return i._callEventListener(o,u)})},this._handleMessage=function(o){i._debug("message event"),i.onmessage&&i.onmessage(o),i._listeners.message.forEach(function(s){return i._callEventListener(o,s)})},this._handleError=function(o){i._debug("error event",o.message),i._disconnect(void 0,o.message==="TIMEOUT"?"timeout":void 0),i.onerror&&i.onerror(o),i._debug("exec error listeners"),i._listeners.error.forEach(function(s){return i._callEventListener(o,s)}),i._connect()},this._handleClose=function(o){i._debug("close event"),i._clearTimeouts(),i._shouldReconnect&&i._connect(),i.onclose&&i.onclose(o),i._listeners.close.forEach(function(s){return i._callEventListener(o,s)})},this._url=e,this._protocols=t,this._options=r,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(n,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(n,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(n,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(n,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"CONNECTING",{get:function(){return n.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"OPEN",{get:function(){return n.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"CLOSING",{get:function(){return n.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"CLOSED",{get:function(){return n.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bufferedAmount",{get:function(){var e=this._messageQueue.reduce(function(t,r){return typeof r=="string"?t+=r.length:r instanceof Blob?t+=r.size:t+=r.byteLength,t},0);return e+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?n.CLOSED:n.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),n.prototype.close=function(e,t){if(e===void 0&&(e=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(e,t)},n.prototype.reconnect=function(e,t){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(e,t),this._connect())},n.prototype.send=function(e){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",e),this._ws.send(e);else{var t=this._options.maxEnqueuedMessages,r=t===void 0?l.maxEnqueuedMessages:t;this._messageQueue.length<r&&(this._debug("enqueue",e),this._messageQueue.push(e))}},n.prototype.addEventListener=function(e,t){this._listeners[e]&&this._listeners[e].push(t)},n.prototype.removeEventListener=function(e,t){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(function(r){return r!==t}))},n.prototype._debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._options.debug&&console.log.apply(console,L(["RWS>"],e))},n.prototype._getNextDelay=function(){var e=this._options,t=e.reconnectionDelayGrowFactor,r=t===void 0?l.reconnectionDelayGrowFactor:t,i=e.minReconnectionDelay,o=i===void 0?l.minReconnectionDelay:i,s=e.maxReconnectionDelay,c=s===void 0?l.maxReconnectionDelay:s,u=0;return this._retryCount>0&&(u=o*Math.pow(r,this._retryCount-1),u>c&&(u=c)),this._debug("next delay",u),u},n.prototype._wait=function(){var e=this;return new Promise(function(t){setTimeout(t,e._getNextDelay())})},n.prototype._getNextUrl=function(e){if(typeof e=="string")return Promise.resolve(e);if(typeof e=="function"){var t=e();if(typeof t=="string")return Promise.resolve(t);if(t.then)return t}throw Error("Invalid URL")},n.prototype._connect=function(){var e=this;if(!(this._connectLock||!this._shouldReconnect)){this._connectLock=!0;var t=this._options,r=t.maxRetries,i=r===void 0?l.maxRetries:r,o=t.connectionTimeout,s=o===void 0?l.connectionTimeout:o,c=t.WebSocket,u=c===void 0?x():c;if(this._retryCount>=i){this._debug("max retries reached",this._retryCount,">=",i);return}if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!P(u))throw Error("No valid WebSocket class provided");this._wait().then(function(){return e._getNextUrl(e._url)}).then(function(a){e._closeCalled||(e._debug("connect",{url:a,protocols:e._protocols}),e._ws=e._protocols?new u(a,e._protocols):new u(a),e._ws.binaryType=e._binaryType,e._connectLock=!1,e._addListeners(),e._connectTimeout=setTimeout(function(){return e._handleTimeout()},s))})}},n.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new D(Error("TIMEOUT"),this))},n.prototype._disconnect=function(e,t){if(e===void 0&&(e=1e3),this._clearTimeouts(),!!this._ws){this._removeListeners();try{this._ws.close(e,t),this._handleClose(new N(e,t,this))}catch{}}},n.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},n.prototype._callEventListener=function(e,t){"handleEvent"in t?t.handleEvent(e):t(e)},n.prototype._removeListeners=function(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},n.prototype._addListeners=function(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},n.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},n}();function p(n){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?p=function(e){return typeof e}:p=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(n)}function R(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function m(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function j(n,e,t){return e&&m(n.prototype,e),t&&m(n,t),n}var B=typeof process<"u"?"arraybuffer":"blob",b={},v=function(e){var t=e.data;return t?(e.data instanceof ArrayBuffer&&(t=new TextDecoder().decode(t)),JSON.parse(t)):e},M=function(){function n(e){var t=this,r=e.uri,i=e.binaryType,o=e.ping,s=e.options;R(this,n),this.uri=r,i||(i=B),typeof TextEncoder>"u"&&(i="blob"),this.binaryType=i,this.id=10,this.sendQueue=[],this.callbacks=new Map,this.keeper=null,this.pingFrame=o||"💧",this.keeping=function(){clearTimeout(t.keeper),t.keeper=setTimeout(function(){t.send(t.pingFrame),t.keeping()},55e3)};var c=b[r];if(c)return this.ws=c;this.ws=c=b[r]=new I(r,[],s),this.ws.addEventListener("open",function(){for(t.ws.binaryType=t.binaryType;t.sendQueue.length;)t.send(t.sendQueue.shift());t.keeping()}),this.ws.addEventListener("message",function(u){var a=v(u),g=t.callbacks.get(a.id);g&&(g(a.result||a),t.callbacks.delete(a.id))})}return j(n,[{key:"send",value:function(t,r){var i=t;p(i)==="object"&&(i=Object.assign({},i,{id:this.id++}),r&&this.callbacks.set(i.id,r),i=JSON.stringify(i)),this.ws.readyState===1?this.ws.send(this.binaryType==="arraybuffer"?new TextEncoder().encode(i).buffer:i):i!==this.pingFrame&&this.sendQueue.push(i)}},{key:"on",value:function(t,r){var i=function(s){return r(v(s))};return this.ws.addEventListener(t,i),i}},{key:"off",value:function(t,r){this.ws.removeEventListener(t,r)}}]),n}();const W={testnet:{chainId:"testnet",title:"DOID Testnet",name:"DOIDTestnet",provider:"http://54.221.168.235:8556",providerWs:"ws://54.221.168.235:8557",scan:"http://explorer.testnet.doid.tech",icon:""}},G="testnet",O=W[G];var U=Object.defineProperty,Q=Object.getOwnPropertyDescriptor,d=(n,e,t,r)=>{for(var i=r>1?void 0:r?Q(e,t):e,o=n.length-1,s;o>=0;o--)(s=n[o])&&(i=(r?s(e,t,i):s(i))||i);return r&&i&&U(e,t,i),i};const T=new M({uri:O.providerWs}),_=async(n,e)=>T.send({jsonrpc:"2.0",...n},e),C=`blocks.${O.chainId}`,F=JSON.parse(sessionStorage.getItem(C)??"[]").map(n=>(delete n.incoming,n));class h extends S{constructor(){super(),this.delay=3e3,this.updateBlocks=async()=>{const e=new Date().getTime();this.blocks=this.blocks.map(t=>{const{incoming:r=!1,timestamp:i=0}=t;return r&&i&&e-+i*1e3>this.delay&&delete t.incoming,t}),sessionStorage.setItem(C,JSON.stringify(this.blocks))},this.addBlock=(e,t=!1)=>{!e||this.blocks.some(r=>r.height===e.height)||(e.incoming=!0,setTimeout(()=>e.incoming=!1,this.delay),this.blocks.unshift(e),this.blocks.sort((r,i)=>i.height-r.height),this.blocks.length=Math.min(this.limit,this.blocks.length),t&&this.updateBlocks())},this.getBlocks=async()=>{this.pending=!0,_({method:"doid_currentBlock",params:[]},({header:e}={})=>{this.addBlock(e);for(let t=e.height-1;t>e.height-this.limit;t--)_({method:"doid_getBlockByHeight",params:[t]},r=>{this.addBlock(r==null?void 0:r.header),this.ts++})}),this.updateBlocks(),this.pending=!1},this.getBlocks(),_({method:"doid_subscribe",params:["newHeads"]}),this.ws.on("message",({method:e,params:t}={})=>{if(!t)return;const{header:r}=t==null?void 0:t.result;switch(e){case"doid_subscription":r&&this.addBlock(r,!0);return}}),this.ws.on("open",this.getBlocks)}get isEmpty(){return this.ts&&!this.blocks.length}get loading(){return!this.ts}get isConnected(){const{ws:{readyState:e,OPEN:t}}=this.ws;return e===t}}d([f({value:T})],h.prototype,"ws",2);d([f({value:!1})],h.prototype,"pending",2);d([f({value:0})],h.prototype,"ts",2);d([f({value:20})],h.prototype,"limit",2);d([f({value:F})],h.prototype,"blocks",2);const A=new h;export{A as u,_ as w};
